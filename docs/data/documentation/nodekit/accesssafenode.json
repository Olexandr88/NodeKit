{"sections":[],"schemaVersion":{"minor":3,"major":0,"patch":0},"topicSections":[{"identifiers":["doc:\/\/NodeKit\/documentation\/NodeKit\/AccessSafeNode\/init(next:updateTokenChain:)"],"title":"Initializers"},{"title":"Instance Properties","identifiers":["doc:\/\/NodeKit\/documentation\/NodeKit\/AccessSafeNode\/next","doc:\/\/NodeKit\/documentation\/NodeKit\/AccessSafeNode\/updateTokenChain"]},{"title":"Instance Methods","identifiers":["doc:\/\/NodeKit\/documentation\/NodeKit\/AccessSafeNode\/process(_:logContext:)"]},{"identifiers":["doc:\/\/NodeKit\/documentation\/NodeKit\/AccessSafeNode\/AsyncNode-Implementations","doc:\/\/NodeKit\/documentation\/NodeKit\/AccessSafeNode\/CombineCompatibleNode-Implementations","doc:\/\/NodeKit\/documentation\/NodeKit\/AccessSafeNode\/Node-Implementations"],"title":"Default Implementations","generated":true}],"metadata":{"roleHeading":"Class","externalID":"s:7NodeKit010AccessSafeA0C","navigatorTitle":[{"text":"AccessSafeNode","kind":"identifier"}],"symbolKind":"class","modules":[{"name":"NodeKit"}],"title":"AccessSafeNode","fragments":[{"kind":"keyword","text":"class"},{"text":" ","kind":"text"},{"kind":"identifier","text":"AccessSafeNode"}],"role":"symbol"},"relationshipsSections":[{"type":"conformsTo","title":"Conforms To","kind":"relationships","identifiers":["doc:\/\/NodeKit\/documentation\/NodeKit\/AsyncNode","doc:\/\/NodeKit\/documentation\/NodeKit\/CombineCompatibleNode","doc:\/\/NodeKit\/documentation\/NodeKit\/Node"]}],"kind":"symbol","hierarchy":{"paths":[["doc:\/\/NodeKit\/documentation\/NodeKit"]]},"identifier":{"url":"doc:\/\/NodeKit\/documentation\/NodeKit\/AccessSafeNode","interfaceLanguage":"swift"},"primaryContentSections":[{"kind":"declarations","declarations":[{"platforms":["macOS"],"tokens":[{"text":"class","kind":"keyword"},{"text":" ","kind":"text"},{"text":"AccessSafeNode","kind":"identifier"},{"text":"<","kind":"text"},{"text":"Output","kind":"genericParameter"},{"kind":"text","text":">"}],"languages":["swift"]}]},{"kind":"content","content":[{"anchor":"Description","text":"Description","type":"heading","level":2},{"type":"paragraph","inlineContent":[{"text":"Node implementing logic for maintaining access to a remote resource.","type":"text"},{"text":" ","type":"text"},{"text":"Let us consider a scheme for OAuth 2.0.","type":"text"}]},{"anchor":"Example","type":"heading","text":"Example","level":2},{"inlineContent":[{"type":"text","text":"After authorization, the user receives:"}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"AccessToken - to access the resource. The token has a lifetime.","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"RefreshToken - a token to refresh the AccessToken without going through the authentication procedure."}],"type":"paragraph"}]}]},{"inlineContent":[{"text":"Let’s consider a situation with an “expired” token:","type":"text"}],"type":"paragraph"},{"type":"orderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"Send a request with the “expired” token."}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"The server returns an error with code 403 (or 401)."}]}]},{"content":[{"inlineContent":[{"type":"text","text":"The node initiates a chain to refresh the token, while saving the request itself."}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"The chain returns a result:","type":"text"}]},{"type":"orderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Success - continue working."}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Error - chain execution ends."}],"type":"paragraph"}]}]}]},{"content":[{"inlineContent":[{"text":"Retry the request with the new token.","type":"text"}],"type":"paragraph"}]}]},{"level":2,"anchor":"Need-to-Know","text":"Need to Know","type":"heading"},{"content":[{"inlineContent":[{"text":"It is obvious that this node should be placed ","type":"text"},{"inlineContent":[{"type":"text","text":"before"}],"type":"strong"},{"text":" the node that inserts the token into the request.","type":"text"}],"type":"paragraph"}],"style":"important","name":"Important","type":"aside"},{"type":"paragraph","inlineContent":[{"text":"The node also handles multiple requests in a thread-safe manner.","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"That is, if we send multiple requests “simultaneously” and the first request fails due to access error, all other requests will be frozen."},{"type":"text","text":" "},{"text":"When the token is refreshed, all frozen requests will be resent to the network.","type":"text"}]},{"inlineContent":[{"text":"Obviously, if a new request comes in during the token refresh wait, it will also be frozen and later resent.","type":"text"}],"type":"paragraph"},{"style":"warning","type":"aside","content":[{"type":"paragraph","inlineContent":[{"text":"There is a possibility that a request will not be sent if it was sent at the exact moment when the token was refreshed and we started sending requests again, but the probability of this event is extremely low. You would need to send hundreds of requests per second to achieve this. Moreover, this situation is most likely impossible because after token refresh, the request won’t be frozen.","type":"text"}]}],"name":"Warning"}]}],"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/nodekit\/accesssafenode"]}],"references":{"doc://NodeKit/documentation/NodeKit/AccessSafeNode":{"identifier":"doc:\/\/NodeKit\/documentation\/NodeKit\/AccessSafeNode","fragments":[{"kind":"keyword","text":"class"},{"text":" ","kind":"text"},{"kind":"identifier","text":"AccessSafeNode"}],"title":"AccessSafeNode","kind":"symbol","navigatorTitle":[{"text":"AccessSafeNode","kind":"identifier"}],"role":"symbol","url":"\/documentation\/nodekit\/accesssafenode","type":"topic","abstract":[]},"doc://NodeKit/documentation/NodeKit/AccessSafeNode/next":{"identifier":"doc:\/\/NodeKit\/documentation\/NodeKit\/AccessSafeNode\/next","url":"\/documentation\/nodekit\/accesssafenode\/next","kind":"symbol","abstract":[{"text":"The next node for processing.","type":"text"}],"title":"next","role":"symbol","fragments":[{"text":"var","kind":"keyword"},{"kind":"text","text":" "},{"text":"next","kind":"identifier"},{"text":": any ","kind":"text"},{"preciseIdentifier":"s:7NodeKit05AsyncA0P","kind":"typeIdentifier","text":"AsyncNode"},{"text":"<","kind":"text"},{"kind":"typeIdentifier","preciseIdentifier":"s:7NodeKit19TransportURLRequestV","text":"TransportURLRequest"},{"text":", ","kind":"text"},{"kind":"typeIdentifier","text":"Output"},{"text":">","kind":"text"}],"type":"topic"},"doc://NodeKit/documentation/NodeKit/AccessSafeNode/Node-Implementations":{"abstract":[],"type":"topic","kind":"article","title":"Node Implementations","url":"\/documentation\/nodekit\/accesssafenode\/node-implementations","identifier":"doc:\/\/NodeKit\/documentation\/NodeKit\/AccessSafeNode\/Node-Implementations","role":"collectionGroup"},"doc://NodeKit/documentation/NodeKit/AccessSafeNode/CombineCompatibleNode-Implementations":{"url":"\/documentation\/nodekit\/accesssafenode\/combinecompatiblenode-implementations","title":"CombineCompatibleNode Implementations","role":"collectionGroup","type":"topic","kind":"article","abstract":[],"identifier":"doc:\/\/NodeKit\/documentation\/NodeKit\/AccessSafeNode\/CombineCompatibleNode-Implementations"},"doc://NodeKit/documentation/NodeKit/TokenRefresherNode":{"navigatorTitle":[{"text":"TokenRefresherNode","kind":"identifier"}],"type":"topic","abstract":[{"type":"text","text":"Node for token refreshing and freezing requests."}],"role":"symbol","title":"TokenRefresherNode","identifier":"doc:\/\/NodeKit\/documentation\/NodeKit\/TokenRefresherNode","url":"\/documentation\/nodekit\/tokenrefreshernode","kind":"symbol","fragments":[{"text":"class","kind":"keyword"},{"text":" ","kind":"text"},{"text":"TokenRefresherNode","kind":"identifier"}]},"doc://NodeKit/documentation/NodeKit/AccessSafeNode/updateTokenChain":{"type":"topic","abstract":[{"type":"text","text":"Token refresh chain."},{"text":" ","type":"text"},{"type":"text","text":"This chain should initially disable the node that implements request freezing and resumption."},{"text":" ","type":"text"},{"text":"Out of the box, this is implemented by the ","type":"text"},{"isActive":true,"type":"reference","identifier":"doc:\/\/NodeKit\/documentation\/NodeKit\/TokenRefresherNode"},{"type":"text","text":" node."}],"kind":"symbol","title":"updateTokenChain","url":"\/documentation\/nodekit\/accesssafenode\/updatetokenchain","identifier":"doc:\/\/NodeKit\/documentation\/NodeKit\/AccessSafeNode\/updateTokenChain","role":"symbol","fragments":[{"text":"var","kind":"keyword"},{"text":" ","kind":"text"},{"kind":"identifier","text":"updateTokenChain"},{"text":": any ","kind":"text"},{"kind":"typeIdentifier","preciseIdentifier":"s:7NodeKit05AsyncA0P","text":"AsyncNode"},{"kind":"text","text":"<"},{"preciseIdentifier":"s:s4Voida","kind":"typeIdentifier","text":"Void"},{"text":", ","kind":"text"},{"preciseIdentifier":"s:s4Voida","kind":"typeIdentifier","text":"Void"},{"text":">","kind":"text"}]},"doc://NodeKit/documentation/NodeKit/AccessSafeNode/init(next:updateTokenChain:)":{"fragments":[{"text":"init","kind":"identifier"},{"text":"(","kind":"text"},{"text":"next","kind":"externalParam"},{"kind":"text","text":": some "},{"preciseIdentifier":"s:7NodeKit05AsyncA0P","kind":"typeIdentifier","text":"AsyncNode"},{"kind":"text","text":"<"},{"preciseIdentifier":"s:7NodeKit19TransportURLRequestV","kind":"typeIdentifier","text":"TransportURLRequest"},{"kind":"text","text":", "},{"text":"Output","kind":"typeIdentifier"},{"kind":"text","text":">, "},{"text":"updateTokenChain","kind":"externalParam"},{"kind":"text","text":": some "},{"preciseIdentifier":"s:7NodeKit05AsyncA0P","text":"AsyncNode","kind":"typeIdentifier"},{"kind":"text","text":"<(), ()>)"}],"kind":"symbol","title":"init(next:updateTokenChain:)","abstract":[{"type":"text","text":"Initializer."}],"url":"\/documentation\/nodekit\/accesssafenode\/init(next:updatetokenchain:)","type":"topic","identifier":"doc:\/\/NodeKit\/documentation\/NodeKit\/AccessSafeNode\/init(next:updateTokenChain:)","role":"symbol"},"doc://NodeKit/documentation/NodeKit/AccessSafeNode/process(_:logContext:)":{"fragments":[{"kind":"keyword","text":"func"},{"text":" ","kind":"text"},{"kind":"identifier","text":"process"},{"text":"(","kind":"text"},{"kind":"typeIdentifier","preciseIdentifier":"s:7NodeKit19TransportURLRequestV","text":"TransportURLRequest"},{"kind":"text","text":", "},{"kind":"externalParam","text":"logContext"},{"kind":"text","text":": any "},{"preciseIdentifier":"s:7NodeKit22LoggingContextProtocolP","kind":"typeIdentifier","text":"LoggingContextProtocol"},{"text":") ","kind":"text"},{"text":"async","kind":"keyword"},{"text":" -> ","kind":"text"},{"kind":"typeIdentifier","preciseIdentifier":"s:7NodeKit0A6Resulta","text":"NodeResult"},{"kind":"text","text":"<"},{"text":"Output","kind":"typeIdentifier"},{"text":">","kind":"text"}],"kind":"symbol","title":"process(_:logContext:)","abstract":[{"type":"text","text":"Passes control to the next node."},{"text":" ","type":"text"},{"type":"text","text":"If access is returned, it updates the token and retries the request."}],"url":"\/documentation\/nodekit\/accesssafenode\/process(_:logcontext:)","type":"topic","identifier":"doc:\/\/NodeKit\/documentation\/NodeKit\/AccessSafeNode\/process(_:logContext:)","role":"symbol"},"doc://NodeKit/documentation/NodeKit/AsyncNode":{"fragments":[{"text":"protocol","kind":"keyword"},{"text":" ","kind":"text"},{"text":"AsyncNode","kind":"identifier"}],"url":"\/documentation\/nodekit\/asyncnode","kind":"symbol","role":"symbol","type":"topic","title":"AsyncNode","navigatorTitle":[{"kind":"identifier","text":"AsyncNode"}],"abstract":[{"type":"text","text":"Protocol for a node describing the approach of transforming input data into a result using Swift Concurrency."},{"text":" ","type":"text"},{"type":"text","text":"Supports result processing with Combine by inheriting the "},{"isActive":true,"identifier":"doc:\/\/NodeKit\/documentation\/NodeKit\/CombineCompatibleNode","type":"reference"},{"type":"text","text":" protocol."},{"text":" ","type":"text"},{"type":"text","text":"Contains parameters for logging, inheriting the "},{"isActive":true,"type":"reference","identifier":"doc:\/\/NodeKit\/documentation\/NodeKit\/Node"},{"type":"text","text":" protocol."},{"text":" ","type":"text"},{"text":"Applicable for nodes that return a single result.","type":"text"}],"identifier":"doc:\/\/NodeKit\/documentation\/NodeKit\/AsyncNode"},"doc://NodeKit/documentation/NodeKit/Node":{"abstract":[{"text":"Protocol describing any node or chain of nodes.","type":"text"},{"type":"text","text":" "},{"type":"text","text":"Necessary for combining all types of nodes and adding common methods."}],"title":"Node","identifier":"doc:\/\/NodeKit\/documentation\/NodeKit\/Node","fragments":[{"text":"protocol","kind":"keyword"},{"kind":"text","text":" "},{"text":"Node","kind":"identifier"}],"kind":"symbol","type":"topic","url":"\/documentation\/nodekit\/node","role":"symbol","navigatorTitle":[{"kind":"identifier","text":"Node"}]},"doc://NodeKit/documentation/NodeKit/CombineCompatibleNode":{"fragments":[{"text":"protocol","kind":"keyword"},{"text":" ","kind":"text"},{"kind":"identifier","text":"CombineCompatibleNode"}],"navigatorTitle":[{"kind":"identifier","text":"CombineCompatibleNode"}],"role":"symbol","kind":"symbol","type":"topic","identifier":"doc:\/\/NodeKit\/documentation\/NodeKit\/CombineCompatibleNode","url":"\/documentation\/nodekit\/combinecompatiblenode","abstract":[{"type":"text","text":"Protocol for a node describing the approach of transforming input data into a result using Combine."}],"title":"CombineCompatibleNode"},"doc://NodeKit/documentation/NodeKit/AccessSafeNode/AsyncNode-Implementations":{"url":"\/documentation\/nodekit\/accesssafenode\/asyncnode-implementations","type":"topic","identifier":"doc:\/\/NodeKit\/documentation\/NodeKit\/AccessSafeNode\/AsyncNode-Implementations","kind":"article","title":"AsyncNode Implementations","role":"collectionGroup","abstract":[]},"doc://NodeKit/documentation/NodeKit":{"role":"collection","type":"topic","identifier":"doc:\/\/NodeKit\/documentation\/NodeKit","kind":"symbol","title":"NodeKit","url":"\/documentation\/nodekit","abstract":[]}}}